"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(t){return 10>t?"0"+t:t}function quote(t){return escapable.lastIndex=0,escapable.test(t)?'"'+t.replace(escapable,function(t){var e=meta[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function str(t,e){var n,r,i,s,o,a=gap,u=e[t];switch(u&&"object"==typeof u&&"function"==typeof u.toJSON&&(u=u.toJSON(t)),"function"==typeof rep&&(u=rep.call(e,t,u)),typeof u){case"string":return quote(u);case"number":return isFinite(u)?String(u):"null";case"boolean":case"null":return String(u);case"object":if(!u)return"null";if(gap+=indent,o=[],"[object Array]"===Object.prototype.toString.apply(u)){for(s=u.length,n=0;s>n;n+=1)o[n]=str(n,u)||"null";return i=0===o.length?"[]":gap?"[\n"+gap+o.join(",\n"+gap)+"\n"+a+"]":"["+o.join(",")+"]",gap=a,i}if(rep&&"object"==typeof rep)for(s=rep.length,n=0;s>n;n+=1)"string"==typeof rep[n]&&(r=rep[n],i=str(r,u),i&&o.push(quote(r)+(gap?": ":":")+i));else for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(i=str(r,u),i&&o.push(quote(r)+(gap?": ":":")+i));return i=0===o.length?"{}":gap?"{\n"+gap+o.join(",\n"+gap)+"\n"+a+"}":"{"+o.join(",")+"}",gap=a,i}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(t,e,n){var r;if(gap="",indent="","number"==typeof n)for(r=0;n>r;r+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=e,e&&"function"!=typeof e&&("object"!=typeof e||"number"!=typeof e.length))throw new Error("JSON.stringify");return str("",{"":t})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(t,e){var n,r,i=t[e];if(i&&"object"==typeof i)for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),void 0!==r?i[n]=r:delete i[n]);return reviver.call(t,e,i)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(){var t=this,e=t._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,a=r.slice,u=r.concat,c=i.toString,l=i.hasOwnProperty,f=r.forEach,h=r.map,d=r.reduce,p=r.reduceRight,g=r.filter,v=r.every,m=r.some,y=r.indexOf,_=r.lastIndexOf,b=Array.isArray,w=Object.keys,x=s.bind,k=function(t){return t instanceof k?t:this instanceof k?void(this._wrapped=t):new k(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=k),exports._=k):t._=k,k.VERSION="1.5.1";var S=k.each=k.forEach=function(t,e,r){if(null!=t)if(f&&t.forEach===f)t.forEach(e,r);else if(t.length===+t.length){for(var i=0,s=t.length;s>i;i++)if(e.call(r,t[i],i,t)===n)return}else for(var o in t)if(k.has(t,o)&&e.call(r,t[o],o,t)===n)return};k.map=k.collect=function(t,e,n){var r=[];return null==t?r:h&&t.map===h?t.map(e,n):(S(t,function(t,i,s){r.push(e.call(n,t,i,s))}),r)};var O="Reduce of empty array with no initial value";k.reduce=k.foldl=k.inject=function(t,e,n,r){var i=arguments.length>2;if(null==t&&(t=[]),d&&t.reduce===d)return r&&(e=k.bind(e,r)),i?t.reduce(e,n):t.reduce(e);if(S(t,function(t,s,o){i?n=e.call(r,n,t,s,o):(n=t,i=!0)}),!i)throw new TypeError(O);return n},k.reduceRight=k.foldr=function(t,e,n,r){var i=arguments.length>2;if(null==t&&(t=[]),p&&t.reduceRight===p)return r&&(e=k.bind(e,r)),i?t.reduceRight(e,n):t.reduceRight(e);var s=t.length;if(s!==+s){var o=k.keys(t);s=o.length}if(S(t,function(a,u,c){u=o?o[--s]:--s,i?n=e.call(r,n,t[u],u,c):(n=t[u],i=!0)}),!i)throw new TypeError(O);return n},k.find=k.detect=function(t,e,n){var r;return j(t,function(t,i,s){return e.call(n,t,i,s)?(r=t,!0):void 0}),r},k.filter=k.select=function(t,e,n){var r=[];return null==t?r:g&&t.filter===g?t.filter(e,n):(S(t,function(t,i,s){e.call(n,t,i,s)&&r.push(t)}),r)},k.reject=function(t,e,n){return k.filter(t,function(t,r,i){return!e.call(n,t,r,i)},n)},k.every=k.all=function(t,e,r){e||(e=k.identity);var i=!0;return null==t?i:v&&t.every===v?t.every(e,r):(S(t,function(t,s,o){return(i=i&&e.call(r,t,s,o))?void 0:n}),!!i)};var j=k.some=k.any=function(t,e,r){e||(e=k.identity);var i=!1;return null==t?i:m&&t.some===m?t.some(e,r):(S(t,function(t,s,o){return i||(i=e.call(r,t,s,o))?n:void 0}),!!i)};k.contains=k.include=function(t,e){return null==t?!1:y&&t.indexOf===y?-1!=t.indexOf(e):j(t,function(t){return t===e})},k.invoke=function(t,e){var n=a.call(arguments,2),r=k.isFunction(e);return k.map(t,function(t){return(r?e:t[e]).apply(t,n)})},k.pluck=function(t,e){return k.map(t,function(t){return t[e]})},k.where=function(t,e,n){return k.isEmpty(e)?n?void 0:[]:k[n?"find":"filter"](t,function(t){for(var n in e)if(e[n]!==t[n])return!1;return!0})},k.findWhere=function(t,e){return k.where(t,e,!0)},k.max=function(t,e,n){if(!e&&k.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.max.apply(Math,t);if(!e&&k.isEmpty(t))return-(1/0);var r={computed:-(1/0),value:-(1/0)};return S(t,function(t,i,s){var o=e?e.call(n,t,i,s):t;o>r.computed&&(r={value:t,computed:o})}),r.value},k.min=function(t,e,n){if(!e&&k.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.min.apply(Math,t);if(!e&&k.isEmpty(t))return 1/0;var r={computed:1/0,value:1/0};return S(t,function(t,i,s){var o=e?e.call(n,t,i,s):t;o<r.computed&&(r={value:t,computed:o})}),r.value},k.shuffle=function(t){var e,n=0,r=[];return S(t,function(t){e=k.random(n++),r[n-1]=r[e],r[e]=t}),r};var C=function(t){return k.isFunction(t)?t:function(e){return e[t]}};k.sortBy=function(t,e,n){var r=C(e);return k.pluck(k.map(t,function(t,e,i){return{value:t,index:e,criteria:r.call(n,t,e,i)}}).sort(function(t,e){var n=t.criteria,r=e.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(r>n||void 0===r)return-1}return t.index<e.index?-1:1}),"value")};var E=function(t,e,n,r){var i={},s=C(null==e?k.identity:e);return S(t,function(e,o){var a=s.call(n,e,o,t);r(i,a,e)}),i};k.groupBy=function(t,e,n){return E(t,e,n,function(t,e,n){(k.has(t,e)?t[e]:t[e]=[]).push(n)})},k.countBy=function(t,e,n){return E(t,e,n,function(t,e){k.has(t,e)||(t[e]=0),t[e]++})},k.sortedIndex=function(t,e,n,r){n=null==n?k.identity:C(n);for(var i=n.call(r,e),s=0,o=t.length;o>s;){var a=s+o>>>1;n.call(r,t[a])<i?s=a+1:o=a}return s},k.toArray=function(t){return t?k.isArray(t)?a.call(t):t.length===+t.length?k.map(t,k.identity):k.values(t):[]},k.size=function(t){return null==t?0:t.length===+t.length?t.length:k.keys(t).length},k.first=k.head=k.take=function(t,e,n){return null!=t?null==e||n?t[0]:a.call(t,0,e):void 0},k.initial=function(t,e,n){return a.call(t,0,t.length-(null==e||n?1:e))},k.last=function(t,e,n){return null!=t?null==e||n?t[t.length-1]:a.call(t,Math.max(t.length-e,0)):void 0},k.rest=k.tail=k.drop=function(t,e,n){return a.call(t,null==e||n?1:e)},k.compact=function(t){return k.filter(t,k.identity)};var F=function(t,e,n){return e&&k.every(t,k.isArray)?u.apply(n,t):(S(t,function(t){k.isArray(t)||k.isArguments(t)?e?o.apply(n,t):F(t,e,n):n.push(t)}),n)};k.flatten=function(t,e){return F(t,e,[])},k.without=function(t){return k.difference(t,a.call(arguments,1))},k.uniq=k.unique=function(t,e,n,r){k.isFunction(e)&&(r=n,n=e,e=!1);var i=n?k.map(t,n,r):t,s=[],o=[];return S(i,function(n,r){(e?r&&o[o.length-1]===n:k.contains(o,n))||(o.push(n),s.push(t[r]))}),s},k.union=function(){return k.uniq(k.flatten(arguments,!0))},k.intersection=function(t){var e=a.call(arguments,1);return k.filter(k.uniq(t),function(t){return k.every(e,function(e){return k.indexOf(e,t)>=0})})},k.difference=function(t){var e=u.apply(r,a.call(arguments,1));return k.filter(t,function(t){return!k.contains(e,t)})},k.zip=function(){for(var t=k.max(k.pluck(arguments,"length").concat(0)),e=new Array(t),n=0;t>n;n++)e[n]=k.pluck(arguments,""+n);return e},k.object=function(t,e){if(null==t)return{};for(var n={},r=0,i=t.length;i>r;r++)e?n[t[r]]=e[r]:n[t[r][0]]=t[r][1];return n},k.indexOf=function(t,e,n){if(null==t)return-1;var r=0,i=t.length;if(n){if("number"!=typeof n)return r=k.sortedIndex(t,e),t[r]===e?r:-1;r=0>n?Math.max(0,i+n):n}if(y&&t.indexOf===y)return t.indexOf(e,n);for(;i>r;r++)if(t[r]===e)return r;return-1},k.lastIndexOf=function(t,e,n){if(null==t)return-1;var r=null!=n;if(_&&t.lastIndexOf===_)return r?t.lastIndexOf(e,n):t.lastIndexOf(e);for(var i=r?n:t.length;i--;)if(t[i]===e)return i;return-1},k.range=function(t,e,n){arguments.length<=1&&(e=t||0,t=0),n=arguments[2]||1;for(var r=Math.max(Math.ceil((e-t)/n),0),i=0,s=new Array(r);r>i;)s[i++]=t,t+=n;return s};var N=function(){};k.bind=function(t,e){var n,r;if(x&&t.bind===x)return x.apply(t,a.call(arguments,1));if(!k.isFunction(t))throw new TypeError;return n=a.call(arguments,2),r=function(){if(!(this instanceof r))return t.apply(e,n.concat(a.call(arguments)));N.prototype=t.prototype;var i=new N;N.prototype=null;var s=t.apply(i,n.concat(a.call(arguments)));return Object(s)===s?s:i}},k.partial=function(t){var e=a.call(arguments,1);return function(){return t.apply(this,e.concat(a.call(arguments)))}},k.bindAll=function(t){var e=a.call(arguments,1);if(0===e.length)throw new Error("bindAll must be passed function names");return S(e,function(e){t[e]=k.bind(t[e],t)}),t},k.memoize=function(t,e){var n={};return e||(e=k.identity),function(){var r=e.apply(this,arguments);return k.has(n,r)?n[r]:n[r]=t.apply(this,arguments)}},k.delay=function(t,e){var n=a.call(arguments,2);return setTimeout(function(){return t.apply(null,n)},e)},k.defer=function(t){return k.delay.apply(k,[t,1].concat(a.call(arguments,1)))},k.throttle=function(t,e,n){var r,i,s,o=null,a=0;n||(n={});var u=function(){a=n.leading===!1?0:new Date,o=null,s=t.apply(r,i)};return function(){var c=new Date;a||n.leading!==!1||(a=c);var l=e-(c-a);return r=this,i=arguments,0>=l?(clearTimeout(o),o=null,a=c,s=t.apply(r,i)):o||n.trailing===!1||(o=setTimeout(u,l)),s}},k.debounce=function(t,e,n){var r,i=null;return function(){var s=this,o=arguments,a=function(){i=null,n||(r=t.apply(s,o))},u=n&&!i;return clearTimeout(i),i=setTimeout(a,e),u&&(r=t.apply(s,o)),r}},k.once=function(t){var e,n=!1;return function(){return n?e:(n=!0,e=t.apply(this,arguments),t=null,e)}},k.wrap=function(t,e){return function(){var n=[t];return o.apply(n,arguments),e.apply(this,n)}},k.compose=function(){var t=arguments;return function(){for(var e=arguments,n=t.length-1;n>=0;n--)e=[t[n].apply(this,e)];return e[0]}},k.after=function(t,e){return function(){return--t<1?e.apply(this,arguments):void 0}},k.keys=w||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var n in t)k.has(t,n)&&e.push(n);return e},k.values=function(t){var e=[];for(var n in t)k.has(t,n)&&e.push(t[n]);return e},k.pairs=function(t){var e=[];for(var n in t)k.has(t,n)&&e.push([n,t[n]]);return e},k.invert=function(t){var e={};for(var n in t)k.has(t,n)&&(e[t[n]]=n);return e},k.functions=k.methods=function(t){var e=[];for(var n in t)k.isFunction(t[n])&&e.push(n);return e.sort()},k.extend=function(t){return S(a.call(arguments,1),function(e){if(e)for(var n in e)t[n]=e[n]}),t},k.pick=function(t){var e={},n=u.apply(r,a.call(arguments,1));return S(n,function(n){n in t&&(e[n]=t[n])}),e},k.omit=function(t){var e={},n=u.apply(r,a.call(arguments,1));for(var i in t)k.contains(n,i)||(e[i]=t[i]);return e},k.defaults=function(t){return S(a.call(arguments,1),function(e){if(e)for(var n in e)void 0===t[n]&&(t[n]=e[n])}),t},k.clone=function(t){return k.isObject(t)?k.isArray(t)?t.slice():k.extend({},t):t},k.tap=function(t,e){return e(t),t};var A=function(t,e,n,r){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;t instanceof k&&(t=t._wrapped),e instanceof k&&(e=e._wrapped);var i=c.call(t);if(i!=c.call(e))return!1;switch(i){case"[object String]":return t==String(e);case"[object Number]":return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object RegExp]":return t.source==e.source&&t.global==e.global&&t.multiline==e.multiline&&t.ignoreCase==e.ignoreCase}if("object"!=typeof t||"object"!=typeof e)return!1;for(var s=n.length;s--;)if(n[s]==t)return r[s]==e;var o=t.constructor,a=e.constructor;if(o!==a&&!(k.isFunction(o)&&o instanceof o&&k.isFunction(a)&&a instanceof a))return!1;n.push(t),r.push(e);var u=0,l=!0;if("[object Array]"==i){if(u=t.length,l=u==e.length)for(;u--&&(l=A(t[u],e[u],n,r)););}else{for(var f in t)if(k.has(t,f)&&(u++,!(l=k.has(e,f)&&A(t[f],e[f],n,r))))break;if(l){for(f in e)if(k.has(e,f)&&!u--)break;l=!u}}return n.pop(),r.pop(),l};k.isEqual=function(t,e){return A(t,e,[],[])},k.isEmpty=function(t){if(null==t)return!0;if(k.isArray(t)||k.isString(t))return 0===t.length;for(var e in t)if(k.has(t,e))return!1;return!0},k.isElement=function(t){return!(!t||1!==t.nodeType)},k.isArray=b||function(t){return"[object Array]"==c.call(t)},k.isObject=function(t){return t===Object(t)},S(["Arguments","Function","String","Number","Date","RegExp"],function(t){k["is"+t]=function(e){return c.call(e)=="[object "+t+"]"}}),k.isArguments(arguments)||(k.isArguments=function(t){return!(!t||!k.has(t,"callee"))}),"function"!=typeof/./&&(k.isFunction=function(t){return"function"==typeof t}),k.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},k.isNaN=function(t){return k.isNumber(t)&&t!=+t},k.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"==c.call(t)},k.isNull=function(t){return null===t},k.isUndefined=function(t){return void 0===t},k.has=function(t,e){return l.call(t,e)},k.noConflict=function(){return t._=e,this},k.identity=function(t){return t},k.times=function(t,e,n){for(var r=Array(Math.max(0,t)),i=0;t>i;i++)r[i]=e.call(n,i);return r},k.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))};var $={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};$.unescape=k.invert($.escape);var M={escape:new RegExp("["+k.keys($.escape).join("")+"]","g"),unescape:new RegExp("("+k.keys($.unescape).join("|")+")","g")};k.each(["escape","unescape"],function(t){k[t]=function(e){return null==e?"":(""+e).replace(M[t],function(e){return $[t][e]})}}),k.result=function(t,e){if(null!=t){var n=t[e];return k.isFunction(n)?n.call(t):n}},k.mixin=function(t){S(k.functions(t),function(e){var n=k[e]=t[e];k.prototype[e]=function(){var t=[this._wrapped];return o.apply(t,arguments),I.call(this,n.apply(k,t))}})};var T=0;k.uniqueId=function(t){var e=++T+"";return t?t+e:e},k.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var B=/(.)^/,R={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},q=/\\|'|\r|\n|\t|\u2028|\u2029/g;k.template=function(t,e,n){var r;n=k.defaults({},n,k.templateSettings);var i=new RegExp([(n.escape||B).source,(n.interpolate||B).source,(n.evaluate||B).source].join("|")+"|$","g"),s=0,o="__p+='";t.replace(i,function(e,n,r,i,a){return o+=t.slice(s,a).replace(q,function(t){return"\\"+R[t]}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(o+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(o+="';\n"+i+"\n__p+='"),s=a+e.length,e}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{r=new Function(n.variable||"obj","_",o)}catch(a){throw a.source=o,a}if(e)return r(e,k);var u=function(t){return r.call(this,t,k)};return u.source="function("+(n.variable||"obj")+"){\n"+o+"}",u},k.chain=function(t){return k(t).chain()};var I=function(t){return this._chain?k(t).chain():t};k.mixin(k),S(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=r[t];k.prototype[t]=function(){var n=this._wrapped;return e.apply(n,arguments),"shift"!=t&&"splice"!=t||0!==n.length||delete n[0],I.call(this,n)}}),S(["concat","join","slice"],function(t){var e=r[t];k.prototype[t]=function(){return I.call(this,e.apply(this._wrapped,arguments))}}),k.extend(k.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),function(){var t,e=this,n=e.Backbone,r=[],i=r.push,s=r.slice,o=r.splice;t="undefined"!=typeof exports?exports:e.Backbone={},t.VERSION="1.0.0";var a=e._;a||"undefined"==typeof require||(a=require("underscore")),t.$=e.jQuery||e.Zepto||e.ender||e.$,t.noConflict=function(){return e.Backbone=n,this},t.emulateHTTP=!1,t.emulateJSON=!1;var u=t.Events={on:function(t,e,n){if(!l(this,"on",t,[e,n])||!e)return this;this._events||(this._events={});var r=this._events[t]||(this._events[t]=[]);return r.push({callback:e,context:n,ctx:n||this}),this},once:function(t,e,n){if(!l(this,"once",t,[e,n])||!e)return this;var r=this,i=a.once(function(){r.off(t,i),e.apply(this,arguments)});return i._callback=e,this.on(t,i,n)},off:function(t,e,n){var r,i,s,o,u,c,f,h;if(!this._events||!l(this,"off",t,[e,n]))return this;if(!t&&!e&&!n)return this._events={},this;for(o=t?[t]:a.keys(this._events),u=0,c=o.length;c>u;u++)if(t=o[u],s=this._events[t]){if(this._events[t]=r=[],e||n)for(f=0,h=s.length;h>f;f++)i=s[f],(e&&e!==i.callback&&e!==i.callback._callback||n&&n!==i.context)&&r.push(i);r.length||delete this._events[t]}return this},trigger:function(t){if(!this._events)return this;var e=s.call(arguments,1);if(!l(this,"trigger",t,e))return this;var n=this._events[t],r=this._events.all;return n&&f(n,e),r&&f(r,arguments),this},stopListening:function(t,e,n){var r=this._listeners;if(!r)return this;var i=!e&&!n;"object"==typeof e&&(n=this),t&&((r={})[t._listenerId]=t);for(var s in r)r[s].off(e,n,this),i&&delete this._listeners[s];return this}},c=/\s+/,l=function(t,e,n,r){if(!n)return!0;if("object"==typeof n){for(var i in n)t[e].apply(t,[i,n[i]].concat(r));return!1}if(c.test(n)){for(var s=n.split(c),o=0,a=s.length;a>o;o++)t[e].apply(t,[s[o]].concat(r));return!1}return!0},f=function(t,e){var n,r=-1,i=t.length,s=e[0],o=e[1],a=e[2];switch(e.length){case 0:for(;++r<i;)(n=t[r]).callback.call(n.ctx);return;case 1:for(;++r<i;)(n=t[r]).callback.call(n.ctx,s);return;case 2:for(;++r<i;)(n=t[r]).callback.call(n.ctx,s,o);return;case 3:for(;++r<i;)(n=t[r]).callback.call(n.ctx,s,o,a);return;default:for(;++r<i;)(n=t[r]).callback.apply(n.ctx,e)}},h={listenTo:"on",listenToOnce:"once"};a.each(h,function(t,e){u[e]=function(e,n,r){var i=this._listeners||(this._listeners={}),s=e._listenerId||(e._listenerId=a.uniqueId("l"));return i[s]=e,"object"==typeof n&&(r=this),e[t](n,r,this),this}}),u.bind=u.on,u.unbind=u.off,a.extend(t,u);var d=t.Model=function(t,e){var n,r=t||{};e||(e={}),this.cid=a.uniqueId("c"),this.attributes={},a.extend(this,a.pick(e,p)),e.parse&&(r=this.parse(r,e)||{}),(n=a.result(this,"defaults"))&&(r=a.defaults({},r,n)),this.set(r,e),this.changed={},this.initialize.apply(this,arguments)},p=["url","urlRoot","collection"];a.extend(d.prototype,u,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return a.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return a.escape(this.get(t))},has:function(t){return null!=this.get(t)},set:function(t,e,n){var r,i,s,o,u,c,l,f;if(null==t)return this;if("object"==typeof t?(i=t,n=e):(i={})[t]=e,n||(n={}),!this._validate(i,n))return!1;s=n.unset,u=n.silent,o=[],c=this._changing,this._changing=!0,c||(this._previousAttributes=a.clone(this.attributes),this.changed={}),f=this.attributes,l=this._previousAttributes,this.idAttribute in i&&(this.id=i[this.idAttribute]);for(r in i)e=i[r],a.isEqual(f[r],e)||o.push(r),a.isEqual(l[r],e)?delete this.changed[r]:this.changed[r]=e,s?delete f[r]:f[r]=e;if(!u){o.length&&(this._pending=!0);for(var h=0,d=o.length;d>h;h++)this.trigger("change:"+o[h],this,f[o[h]],n)}if(c)return this;if(!u)for(;this._pending;)this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,a.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var n in this.attributes)e[n]=void 0;return this.set(e,a.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!a.isEmpty(this.changed):a.has(this.changed,t)},changedAttributes:function(t){if(!t)return this.hasChanged()?a.clone(this.changed):!1;var e,n=!1,r=this._changing?this._previousAttributes:this.attributes;for(var i in t)a.isEqual(r[i],e=t[i])||((n||(n={}))[i]=e);return n},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return a.clone(this._previousAttributes)},fetch:function(t){t=t?a.clone(t):{},void 0===t.parse&&(t.parse=!0);var e=this,n=t.success;return t.success=function(r){return e.set(e.parse(r,t),t)?(n&&n(e,r,t),void e.trigger("sync",e,r,t)):!1},q(this,t),this.sync("read",this,t)},save:function(t,e,n){var r,i,s,o=this.attributes;if(null==t||"object"==typeof t?(r=t,n=e):(r={})[t]=e,r&&(!n||!n.wait)&&!this.set(r,n))return!1;if(n=a.extend({validate:!0},n),!this._validate(r,n))return!1;r&&n.wait&&(this.attributes=a.extend({},o,r)),void 0===n.parse&&(n.parse=!0);var u=this,c=n.success;return n.success=function(t){u.attributes=o;var e=u.parse(t,n);return n.wait&&(e=a.extend(r||{},e)),a.isObject(e)&&!u.set(e,n)?!1:(c&&c(u,t,n),void u.trigger("sync",u,t,n))},q(this,n),i=this.isNew()?"create":n.patch?"patch":"update","patch"===i&&(n.attrs=r),s=this.sync(i,this,n),r&&n.wait&&(this.attributes=o),s},destroy:function(t){t=t?a.clone(t):{};var e=this,n=t.success,r=function(){e.trigger("destroy",e,e.collection,t)};if(t.success=function(i){(t.wait||e.isNew())&&r(),n&&n(e,i,t),e.isNew()||e.trigger("sync",e,i,t)},this.isNew())return t.success(),!1;q(this,t);var i=this.sync("delete",this,t);return t.wait||r(),i},url:function(){var t=a.result(this,"urlRoot")||a.result(this.collection,"url")||R();return this.isNew()?t:t+("/"===t.charAt(t.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(t){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(t){return this._validate({},a.extend(t||{},{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=a.extend({},this.attributes,t);var n=this.validationError=this.validate(t,e)||null;return n?(this.trigger("invalid",this,n,a.extend(e||{},{validationError:n})),!1):!0}});var g=["keys","values","pairs","invert","pick","omit"];a.each(g,function(t){d.prototype[t]=function(){var e=s.call(arguments);return e.unshift(this.attributes),a[t].apply(a,e)}});var v=t.Collection=function(t,e){e||(e={}),e.url&&(this.url=e.url),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,a.extend({silent:!0},e))},m={add:!0,remove:!0,merge:!0},y={add:!0,merge:!1,remove:!1};a.extend(v.prototype,u,{model:d,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return t.sync.apply(this,arguments)},add:function(t,e){return this.set(t,a.defaults(e||{},y))},remove:function(t,e){t=a.isArray(t)?t.slice():[t],e||(e={});var n,r,i,s;for(n=0,r=t.length;r>n;n++)s=this.get(t[n]),s&&(delete this._byId[s.id],delete this._byId[s.cid],i=this.indexOf(s),this.models.splice(i,1),this.length--,e.silent||(e.index=i,s.trigger("remove",s,this,e)),this._removeReference(s));return this},set:function(t,e){e=a.defaults(e||{},m),e.parse&&(t=this.parse(t,e)),a.isArray(t)||(t=t?[t]:[]);var n,r,s,u,c,l=e.at,f=this.comparator&&null==l&&e.sort!==!1,h=a.isString(this.comparator)?this.comparator:null,d=[],p=[],g={};for(n=0,r=t.length;r>n;n++)(s=this._prepareModel(t[n],e))&&((u=this.get(s))?(e.remove&&(g[u.cid]=!0),e.merge&&(u.set(s.attributes,e),f&&!c&&u.hasChanged(h)&&(c=!0))):e.add&&(d.push(s),s.on("all",this._onModelEvent,this),this._byId[s.cid]=s,null!=s.id&&(this._byId[s.id]=s)));if(e.remove){for(n=0,r=this.length;r>n;++n)g[(s=this.models[n]).cid]||p.push(s);p.length&&this.remove(p,e)}if(d.length&&(f&&(c=!0),this.length+=d.length,null!=l?o.apply(this.models,[l,0].concat(d)):i.apply(this.models,d)),c&&this.sort({silent:!0}),e.silent)return this;for(n=0,r=d.length;r>n;n++)(s=d[n]).trigger("add",s,this,e);return c&&this.trigger("sort",this,e),this},reset:function(t,e){e||(e={});for(var n=0,r=this.models.length;r>n;n++)this._removeReference(this.models[n]);return e.previousModels=this.models,this._reset(),this.add(t,a.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),this},push:function(t,e){return t=this._prepareModel(t,e),this.add(t,a.extend({at:this.length},e)),t},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t),e},unshift:function(t,e){return t=this._prepareModel(t,e),this.add(t,a.extend({at:0},e)),t},shift:function(t){var e=this.at(0);return this.remove(e,t),e},slice:function(t,e){return this.models.slice(t,e)},get:function(t){return null!=t?this._byId[null!=t.id?t.id:t.cid||t]:void 0},at:function(t){return this.models[t]},where:function(t,e){return a.isEmpty(t)?e?void 0:[]:this[e?"find":"filter"](function(e){for(var n in t)if(t[n]!==e.get(n))return!1;return!0})},findWhere:function(t){return this.where(t,!0)},sort:function(t){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return t||(t={}),a.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(a.bind(this.comparator,this)),t.silent||this.trigger("sort",this,t),this},sortedIndex:function(t,e,n){e||(e=this.comparator);var r=a.isFunction(e)?e:function(t){return t.get(e)};return a.sortedIndex(this.models,t,r,n)},pluck:function(t){return a.invoke(this.models,"get",t)},fetch:function(t){t=t?a.clone(t):{},void 0===t.parse&&(t.parse=!0);var e=t.success,n=this;return t.success=function(r){var i=t.reset?"reset":"set";n[i](r,t),e&&e(n,r,t),n.trigger("sync",n,r,t)},q(this,t),this.sync("read",this,t)},create:function(t,e){if(e=e?a.clone(e):{},!(t=this._prepareModel(t,e)))return!1;e.wait||this.add(t,e);var n=this,r=e.success;return e.success=function(i){e.wait&&n.add(t,e),r&&r(t,i,e)},t.save(null,e),t},parse:function(t){return t},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(t,e){if(t instanceof d)return t.collection||(t.collection=this),t;e||(e={}),e.collection=this;var n=new this.model(t,e);return n._validate(t,e)?n:(this.trigger("invalid",this,t,e),!1)},_removeReference:function(t){this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,n,r){("add"!==t&&"remove"!==t||n===this)&&("destroy"===t&&this.remove(e,r),e&&t==="change:"+e.idAttribute&&(delete this._byId[e.previous(e.idAttribute)],null!=e.id&&(this._byId[e.id]=e)),this.trigger.apply(this,arguments))}});var _=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];a.each(_,function(t){v.prototype[t]=function(){var e=s.call(arguments);return e.unshift(this.models),a[t].apply(a,e)}});var b=["groupBy","countBy","sortBy"];a.each(b,function(t){v.prototype[t]=function(e,n){var r=a.isFunction(e)?e:function(t){return t.get(e)};return a[t](this.models,r,n)}});var w=t.View=function(t){this.cid=a.uniqueId("view"),this._configure(t||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},x=/^(\S+)\s*(.*)$/,k=["model","collection","el","id","attributes","className","tagName","events"];a.extend(w.prototype,u,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,n){return this.$el&&this.undelegateEvents(),this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0],n!==!1&&this.delegateEvents(),this},delegateEvents:function(t){if(!t&&!(t=a.result(this,"events")))return this;this.undelegateEvents();for(var e in t){var n=t[e];if(a.isFunction(n)||(n=this[t[e]]),n){var r=e.match(x),i=r[1],s=r[2];n=a.bind(n,this),i+=".delegateEvents"+this.cid,""===s?this.$el.on(i,n):this.$el.on(i,s,n)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_configure:function(t){this.options&&(t=a.extend({},a.result(this,"options"),t)),a.extend(this,a.pick(t,k)),this.options=t},_ensureElement:function(){if(this.el)this.setElement(a.result(this,"el"),!1);else{var e=a.extend({},a.result(this,"attributes"));this.id&&(e.id=a.result(this,"id")),this.className&&(e["class"]=a.result(this,"className"));var n=t.$("<"+a.result(this,"tagName")+">").attr(e);this.setElement(n,!1)}}}),t.sync=function(e,n,r){var i=S[e];a.defaults(r||(r={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var s={type:i,dataType:"json"};if(r.url||(s.url=a.result(n,"url")||R()),null!=r.data||!n||"create"!==e&&"update"!==e&&"patch"!==e||(s.contentType="application/json",s.data=JSON.stringify(r.attrs||n.toJSON(r))),r.emulateJSON&&(s.contentType="application/x-www-form-urlencoded",s.data=s.data?{model:s.data}:{}),r.emulateHTTP&&("PUT"===i||"DELETE"===i||"PATCH"===i)){s.type="POST",r.emulateJSON&&(s.data._method=i);var o=r.beforeSend;r.beforeSend=function(t){return t.setRequestHeader("X-HTTP-Method-Override",i),o?o.apply(this,arguments):void 0}}"GET"===s.type||r.emulateJSON||(s.processData=!1),"PATCH"!==s.type||!window.ActiveXObject||window.external&&window.external.msActiveXFilteringEnabled||(s.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var u=r.xhr=t.ajax(a.extend(s,r));return n.trigger("request",n,u,r),u};var S={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var O=t.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},j=/\((.*?)\)/g,C=/(\(\?)?:\w+/g,E=/\*\w+/g,F=/[\-{}\[\]+?.,\\\^$|#\s]/g;a.extend(O.prototype,u,{initialize:function(){},route:function(e,n,r){a.isRegExp(e)||(e=this._routeToRegExp(e)),a.isFunction(n)&&(r=n,n=""),r||(r=this[n]);var i=this;return t.history.route(e,function(s){var o=i._extractParameters(e,s);r&&r.apply(i,o),i.trigger.apply(i,["route:"+n].concat(o)),i.trigger("route",n,o),t.history.trigger("route",i,n,o)}),this},navigate:function(e,n){return t.history.navigate(e,n),this},_bindRoutes:function(){if(this.routes){this.routes=a.result(this,"routes");for(var t,e=a.keys(this.routes);null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(F,"\\$&").replace(j,"(?:$1)?").replace(C,function(t,e){return e?t:"([^/]+)"}).replace(E,"(.*?)"),new RegExp("^"+t+"$")},_extractParameters:function(t,e){var n=t.exec(e).slice(1);return a.map(n,function(t){return t?decodeURIComponent(t):null})}});var N=t.History=function(){this.handlers=[],a.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},A=/^[#\/]|\s+$/g,$=/^\/+|\/+$/g,M=/msie [\w.]+/,T=/\/$/;N.started=!1,a.extend(N.prototype,u,{interval:50,getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getFragment:function(t,e){if(null==t)if(this._hasPushState||!this._wantsHashChange||e){t=this.location.pathname;var n=this.root.replace(T,"");t.indexOf(n)||(t=t.substr(n.length))}else t=this.getHash();return t.replace(A,"")},start:function(e){if(N.started)throw new Error("Backbone.history has already been started");N.started=!0,this.options=a.extend({},{root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var n=this.getFragment(),r=document.documentMode,i=M.exec(navigator.userAgent.toLowerCase())&&(!r||7>=r);
this.root=("/"+this.root+"/").replace($,"/"),i&&this._wantsHashChange&&(this.iframe=t.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(n)),this._hasPushState?t.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!i?t.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=n;var s=this.location,o=s.pathname.replace(/[^\/]$/,"$&/")===this.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!o?(this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&o&&s.hash&&(this.fragment=this.getHash().replace(A,""),this.history.replaceState({},document.title,this.root+this.fragment+s.search)),this.options.silent?void 0:this.loadUrl())},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),N.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(){var t=this.getFragment();return t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe))),t===this.fragment?!1:(this.iframe&&this.navigate(t),void(this.loadUrl()||this.loadUrl(this.getHash())))},loadUrl:function(t){var e=this.fragment=this.getFragment(t),n=a.any(this.handlers,function(t){return t.route.test(e)?(t.callback(e),!0):void 0});return n},navigate:function(t,e){if(!N.started)return!1;if(e&&e!==!0||(e={trigger:e}),t=this.getFragment(t||""),this.fragment!==t){this.fragment=t;var n=this.root+t;if(this._hasPushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getFragment(this.getHash(this.iframe))&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,t,e.replace))}e.trigger&&this.loadUrl(t)}},_updateHash:function(t,e,n){if(n){var r=t.href.replace(/(javascript:|#).*$/,"");t.replace(r+"#"+e)}else t.hash="#"+e}}),t.history=new N;var B=function(t,e){var n,r=this;n=t&&a.has(t,"constructor")?t.constructor:function(){return r.apply(this,arguments)},a.extend(n,r,e);var i=function(){this.constructor=n};return i.prototype=r.prototype,n.prototype=new i,t&&a.extend(n.prototype,t),n.__super__=r.prototype,n};d.extend=v.extend=O.extend=w.extend=N.extend=B;var R=function(){throw new Error('A "url" property or function must be specified')},q=function(t,e){var n=e.error;e.error=function(r){n&&n(t,r,e),t.trigger("error",t,r,e)}}}.call(this),this.recline=this.recline||{},this.recline.Backend=this.recline.Backend||{},this.recline.Backend.CSV=this.recline.Backend.CSV||{},function(t){"use strict";function e(t){return"\n"!==t.charAt(t.length-1)?t:t.substring(0,t.length-1)}t.__type__="csv";var n="undefined"!=typeof jQuery&&jQuery.Deferred||_.Deferred;t.fetch=function(e){var r=new n;if(e.file){var i=new FileReader,s=e.encoding||"UTF-8";i.onload=function(n){var i=t.extractFields(t.parseCSV(n.target.result,e),e);i.useMemoryStore=!0,i.metadata={filename:e.file.name},r.resolve(i)},i.onerror=function(t){alert("Failed to load file. Code: "+t.target.error.code)},i.readAsText(e.file,s)}else if(e.data){var o=t.extractFields(t.parseCSV(e.data,e),e);o.useMemoryStore=!0,r.resolve(o)}else e.url&&jQuery.get(e.url).done(function(n){var i=t.extractFields(t.parseCSV(n,e),e);i.useMemoryStore=!0,r.resolve(i)});return r.promise()},t.extractFields=function(t,e){return e.noHeaderRow!==!0&&t.length>0?{fields:t[0],records:t.slice(1)}:{records:t}},t.parseCSV=function(t,n){t=e(t);var s,a,n=n||{},u=n.trim!==!1,c=n.delimiter||",",l=n.quotechar||'"',f="",h=!1,d=!1,p="",g=[],v=[];for(a=function(t){return d!==!0&&(""===t?t=null:u===!0&&(t=o(t)),r.test(t)?t=parseInt(t,10):i.test(t)&&(t=parseFloat(t,10))),t},s=0;s<t.length;s+=1)f=t.charAt(s),h!==!1||f!==c&&"\n"!==f?f!==l?p+=f:h?t.charAt(s+1)===l?(p+=l,s+=1):h=!1:(h=!0,d=!0):(p=a(p),g.push(p),"\n"===f&&(v.push(g),g=[]),p="",d=!1);return p=a(p),g.push(p),v.push(g),n.skipInitialRows&&(v=v.slice(n.skipInitialRows)),v},t.serializeCSV=function(t,e){var n=null;if(t instanceof Array)n=t;else{n=[];var r=_.pluck(t.fields,"id");n.push(r),_.each(t.records,function(t){var e=_.map(r,function(e){return t[e]});n.push(e)})}var i,o,a,e=e||{},u=e.delimiter||",",c=e.quotechar||'"',l="",f="",h="",d="";for(a=function(t){return null===t?t="":"string"==typeof t&&s.test(t)?t=c+t+c:"number"==typeof t&&(t=t.toString(10)),t},i=0;i<n.length;i+=1)for(l=n[i],o=0;o<l.length;o+=1)f=a(l[o]),o===l.length-1?(h+=f,d+=h+"\n",h=""):h+=f+u,f="";return d};var r=/^\d+$/,i=/^\d*\.\d+$|^\d+\.\d*$/,s=/^\s|\s$|,|"|\n/,o=function(){return String.prototype.trim?function(t){return t.trim()}:function(t){return t.replace(/^\s*/,"").replace(/\s*$/,"")}}()}(this.recline.Backend.CSV),this.recline=this.recline||{},this.recline.Backend=this.recline.Backend||{},this.recline.Backend.Memory=this.recline.Backend.Memory||{},function(t,e){e.__type__="memory",e.Store=function(e,n){var r=this;this.data=e,n?this.fields=n:e&&(this.fields=_.map(e[0],function(t,e){return{id:e}})),this.update=function(t){_.each(r.data,function(e,n){t.id===e.id&&(r.data[n]=t)})},this["delete"]=function(t){var e=_.reject(r.data,function(e){return t.id===e.id});this.data=e},this.save=function(e){var n=this,r=t.Deferred();return _.each(e.updates,function(t){n.update(t)}),_.each(e.deletes,function(t){n["delete"](t)}),r.resolve(),r.promise()},this.query=function(e){var n=t.Deferred(),r=e.size||this.data.length,i=e.from||0,s=this.data;s=this._applyFilters(s,e),s=this._applyFreeTextQuery(s,e),_.each(e.sort,function(t){var e=_.keys(t)[0];s=_.sortBy(s,function(t){var n=t[e];return n}),"desc"==t[e].order&&s.reverse()});var o=this.computeFacets(s,e),a={total:s.length,hits:s.slice(i,i+r),facets:o};return n.resolve(a),n.promise()},this._applyFilters=function(t,e){return _.each(e.filters,function(e){"term"===e.type&&(t=_.filter(t,function(t){return t[e.field]==e.term}))}),t},this._applyFreeTextQuery=function(t,e){if(e.q){var n=e.q.split(" ");t=_.filter(t,function(t){var e=!0;return _.each(n,function(n){var i=!1;_.each(r.fields,function(e){var r=t[e.id];r=null!==r?r.toString():"",i=i||r.toLowerCase()===n.toLowerCase()}),e=e&&i}),e})}return t},this.computeFacets=function(t,e){var n={};return e.facets?(_.each(e.facets,function(t,e){n[e]=new recline.Model.Facet({id:e}).toJSON(),n[e].termsall={}}),_.each(t,function(t){_.each(e.facets,function(e,r){var i=e.terms.field,s=t[i],o=n[r];s?o.termsall[s]=o.termsall[s]?o.termsall[s]+1:1:o.missing=o.missing+1})}),_.each(e.facets,function(t,e){var r=n[e],i=_.map(r.termsall,function(t,e){return{term:e,count:t}});r.terms=_.sortBy(i,function(t){return-t.count}),r.terms=r.terms.slice(0,10)}),n):n},this.transform=function(t){var e=costco.mapDocs(this.data,t);return _.each(e.updates,function(t,e){r.data[e]=t}),this.save(e)}}}(jQuery,this.recline.Backend.Memory),this.recline=this.recline||{},this.recline.Model=this.recline.Model||{},function(t,e){e.Dataset=Backbone.Model.extend({constructor:function(){Backbone.Model.prototype.constructor.apply(this,arguments)},initialize:function(){_.bindAll(this,"query"),this.backend=null,this.get("backend")?this.backend=this._backendFromString(this.get("backend")):this.get("records")&&(this.backend=recline.Backend.Memory),this.fields=new e.FieldList,this.records=new e.RecordList,this._changes={deletes:[],updates:[],creates:[]},this.facets=new e.FacetList,this.recordCount=null,this.queryState=new e.Query,this.queryState.bind("change",this.query),this.queryState.bind("facet:add",this.query),this._store=this.backend,this.backend==recline.Backend.Memory&&this.fetch()},fetch:function(){function e(t){var e=n._normalizeRecordsAndFields(t.records,t.fields);t.useMemoryStore&&(n._store=new recline.Backend.Memory.Store(e.records,e.fields)),n.set(t.metadata),n.fields.reset(e.fields),n.query().done(function(){r.resolve(n)}).fail(function(arguments){r.reject(arguments)})}var n=this,r=t.Deferred();return this.backend!==recline.Backend.Memory?this.backend.fetch(this.toJSON()).done(e).fail(function(arguments){r.reject(arguments)}):e({records:this.get("records"),fields:this.get("fields"),useMemoryStore:!0}),r.promise()},_normalizeRecordsAndFields:function(t,e){if(!e&&t&&t.length>0&&(t[0]instanceof Array?(e=t[0],t=t.slice(1)):e=_.map(_.keys(t[0]),function(t){return{id:t}})),e&&e.length>0&&"string"==typeof e[0]){var n={};e=_.map(e,function(t){var e=t.replace(/^\s+|\s+$/g,"");for(""===e&&(e="_noname_",t=e);e in n;)n[t]+=1,e=t+n[t];return t in n||(n[t]=0),{id:e}})}return t&&t.length>0&&t[0]instanceof Array&&(t=_.map(t,function(t){var n={};return _.each(e,function(e,r){n[e.id]=t[r]}),n})),{fields:e,records:t}},save:function(){return this._store.save(this._changes,this.toJSON())},transform:function(t){var e=this;return this._store.transform?(this.trigger("recline:flash",{message:"Updating all visible docs. This could take a while...",persist:!0,loader:!0}),void this._store.transform(t).done(function(){e.query(),e.trigger("recline:flash",{message:"Records updated successfully"})})):void alert("Transform is not supported with this backend: "+this.get("backend"))},query:function(e){var n=this,r=t.Deferred();this.trigger("query:start"),e&&this.queryState.set(e,{silent:!0});var i=this.queryState.toJSON();return this._store.query(i,this.toJSON()).done(function(t){n._handleQueryResult(t),n.trigger("query:done"),r.resolve(n.records)}).fail(function(arguments){n.trigger("query:fail",arguments),r.reject(arguments)}),r.promise()},_handleQueryResult:function(t){var n=this;n.recordCount=t.total;var r=_.map(t.hits,function(t){var r=new e.Record(t);return r.fields=n.fields,r.bind("change",function(t){n._changes.updates.push(t.toJSON())}),r.bind("destroy",function(t){n._changes.deletes.push(t.toJSON())}),r});if(n.records.reset(r),t.facets){var i=_.map(t.facets,function(t,n){return t.id=n,new e.Facet(t)});n.facets.reset(i)}},toTemplateJSON:function(){var t=this.toJSON();return t.recordCount=this.recordCount,t.fields=this.fields.toJSON(),t},getFieldsSummary:function(){var n=this,r=new e.Query;r.set({size:0}),this.fields.each(function(t){r.addFacet(t.id)});var i=t.Deferred();return this._store.query(r.toJSON(),this.toJSON()).done(function(t){t.facets&&_.each(t.facets,function(t,r){t.id=r;var i=new e.Facet(t);n.fields.get(r).facets.reset(i)}),i.resolve(t)}),i.promise()},recordSummary:function(t){return t.summary()},_backendFromString:function(t){var e=t.split("."),n=window;for(ii=0;ii<e.length&&n;ii++)n=n[e[ii]];if(n)return n;var r=null;return recline&&recline.Backend&&_.each(_.keys(recline.Backend),function(e){e.toLowerCase()===t.toLowerCase()&&(r=recline.Backend[e])}),r}}),e.Dataset.restore=function(t){var e=null;if("memory"===t.backend)var n={records:[{stub:"this is a stub dataset because we do not restore memory datasets"}]};else var n={url:t.url,backend:t.backend};return e=new recline.Model.Dataset(n)},e.Record=Backbone.Model.extend({constructor:function(){Backbone.Model.prototype.constructor.apply(this,arguments)},initialize:function(){_.bindAll(this,"getFieldValue")},getFieldValue:function(t){return val=this.getFieldValueUnrendered(t),t.renderer&&(val=t.renderer(val,t,this.toJSON())),val},getFieldValueUnrendered:function(t){var e=this.get(t.id);return t.deriver&&(e=t.deriver(e,t,this)),e},summary:function(){var t=this,e='<div class="recline-record-summary">';return this.fields.each(function(n){"id"!=n.id&&(e+='<div class="'+n.id+'"><strong>'+n.get("label")+"</strong>: "+t.getFieldValue(n)+"</div>")}),e+="</div>"},fetch:function(){},save:function(){},destroy:function(){this.trigger("destroy",this)}}),e.RecordList=Backbone.Collection.extend({constructor:function(){Backbone.Collection.prototype.constructor.apply(this,arguments)},model:e.Record}),e.Field=Backbone.Model.extend({constructor:function(){Backbone.Model.prototype.constructor.apply(this,arguments)},defaults:{label:null,type:"string",format:null,is_derived:!1},initialize:function(t,n){if("0"in t)throw new Error("Looks like you did not pass a proper hash with id to Field constructor");null===this.attributes.label&&this.set({label:this.id}),n&&(this.renderer=n.renderer,this.deriver=n.deriver),this.renderer||(this.renderer=this.defaultRenderers[this.get("type")]),this.facets=new e.FacetList},defaultRenderers:{object:function(t){return JSON.stringify(t)},geo_point:function(t){return JSON.stringify(t)},"float":function(t,e){var n=e.get("format");return"percentage"===n?t+"%":t},string:function(t,e){var n=e.get("format");if("markdown"===n){if("undefined"!=typeof Showdown){var r=new Showdown.converter;return out=r.makeHtml(t),out}return t}return"plain"==n?t:(t&&"string"==typeof t&&(t=t.replace(/(https?:\/\/[^ ]+)/g,'<a href="$1">$1</a>')),t)}}}),e.FieldList=Backbone.Collection.extend({constructor:function(){Backbone.Collection.prototype.constructor.apply(this,arguments)},model:e.Field}),e.Query=Backbone.Model.extend({constructor:function(){Backbone.Model.prototype.constructor.apply(this,arguments)},defaults:function(){return{size:100,from:0,q:"",facets:{},filters:[]}},_filterTemplates:{term:{type:"term",field:"",term:""},geo_distance:{distance:10,unit:"km",point:{lon:0,lat:0}}},addFilter:function(t){var e=JSON.parse(JSON.stringify(t));_.keys(t).length<=2&&(e=_.extend(this._filterTemplates[t.type],e));var n=this.get("filters");n.push(e),this.trigger("change:filters:new-blank")},updateFilter:function(){},removeFilter:function(t){var e=this.get("filters");e.splice(t,1),this.set({filters:e}),this.trigger("change")},addFacet:function(t){var e=this.get("facets");_.contains(_.keys(e),t)||(e[t]={terms:{field:t}},this.set({facets:e},{silent:!0}),this.trigger("facet:add",this))},addHistogramFacet:function(t){var e=this.get("facets");e[t]={date_histogram:{field:t,interval:"day"}},this.set({facets:e},{silent:!0}),this.trigger("facet:add",this)}}),e.Facet=Backbone.Model.extend({constructor:function(){Backbone.Model.prototype.constructor.apply(this,arguments)},defaults:function(){return{_type:"terms",total:0,other:0,missing:0,terms:[]}}}),e.FacetList=Backbone.Collection.extend({constructor:function(){Backbone.Collection.prototype.constructor.apply(this,arguments)},model:e.Facet}),e.ObjectState=Backbone.Model.extend({}),Backbone.sync=function(t,e,n){return e.backend.sync(t,e,n)}}(jQuery,this.recline.Model),!function(t,e){"use strict";function n(t,e){var n,r,i=t.toLowerCase();for(e=[].concat(e),n=0;e.length>n;n+=1)if(r=e[n]){if(r.test&&r.test(t))return!0;if(r.toLowerCase()===i)return!0}}var r=e.prototype.trim,i=e.prototype.trimRight,s=e.prototype.trimLeft,o=function(t){return 1*t||0},a=function(t,e){if(1>e)return"";for(var n="";e>0;)1&e&&(n+=t),e>>=1,t+=t;return n},u=[].slice,c=function(t){return null==t?"\\s":t.source?t.source:"["+p.escapeRegExp(t)+"]"},l={lt:"<",gt:">",quot:'"',amp:"&",apos:"'"},f={};for(var h in l)f[l[h]]=h;f["'"]="#39";var d=function(){function t(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}var n=a,r=function(){return r.cache.hasOwnProperty(arguments[0])||(r.cache[arguments[0]]=r.parse(arguments[0])),r.format.call(null,r.cache[arguments[0]],arguments)};return r.format=function(r,i){var s,o,a,u,c,l,f,h=1,p=r.length,g="",v=[];for(o=0;p>o;o++)if(g=t(r[o]),"string"===g)v.push(r[o]);else if("array"===g){if(u=r[o],u[2])for(s=i[h],a=0;u[2].length>a;a++){if(!s.hasOwnProperty(u[2][a]))throw new Error(d('[_.sprintf] property "%s" does not exist',u[2][a]));s=s[u[2][a]]}else s=u[1]?i[u[1]]:i[h++];if(/[^s]/.test(u[8])&&"number"!=t(s))throw new Error(d("[_.sprintf] expecting number but found %s",t(s)));switch(u[8]){case"b":s=s.toString(2);break;case"c":s=e.fromCharCode(s);break;case"d":s=parseInt(s,10);break;case"e":s=u[7]?s.toExponential(u[7]):s.toExponential();break;case"f":s=u[7]?parseFloat(s).toFixed(u[7]):parseFloat(s);break;case"o":s=s.toString(8);break;case"s":s=(s=e(s))&&u[7]?s.substring(0,u[7]):s;break;case"u":s=Math.abs(s);break;case"x":s=s.toString(16);break;case"X":s=s.toString(16).toUpperCase()}s=/[def]/.test(u[8])&&u[3]&&s>=0?"+"+s:s,l=u[4]?"0"==u[4]?"0":u[4].charAt(1):" ",f=u[6]-e(s).length,c=u[6]?n(l,f):"",v.push(u[5]?s+c:c+s)}return v.join("")},r.cache={},r.parse=function(t){for(var e=t,n=[],r=[],i=0;e;){if(null!==(n=/^[^\x25]+/.exec(e)))r.push(n[0]);else if(null!==(n=/^\x25{2}/.exec(e)))r.push("%");else{if(null===(n=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(e)))throw new Error("[_.sprintf] huh?");if(n[2]){i|=1;var s=[],o=n[2],a=[];if(null===(a=/^([a-z_][a-z_\d]*)/i.exec(o)))throw new Error("[_.sprintf] huh?");for(s.push(a[1]);""!==(o=o.substring(a[0].length));)if(null!==(a=/^\.([a-z_][a-z_\d]*)/i.exec(o)))s.push(a[1]);else{if(null===(a=/^\[(\d+)\]/.exec(o)))throw new Error("[_.sprintf] huh?");s.push(a[1])}n[2]=s}else i|=2;if(3===i)throw new Error("[_.sprintf] mixing positional and named placeholders is not (yet) supported");r.push(n)}e=e.substring(n[0].length)}return r},r}(),p={VERSION:"2.3.0",isBlank:function(t){return null==t&&(t=""),/^\s*$/.test(t)},stripTags:function(t){return null==t?"":e(t).replace(/<\/?[^>]+>/g,"")},capitalize:function(t){return t=null==t?"":e(t),t.charAt(0).toUpperCase()+t.slice(1)},chop:function(t,n){return null==t?[]:(t=e(t),n=~~n,n>0?t.match(new RegExp(".{1,"+n+"}","g")):[t])},clean:function(t){return p.strip(t).replace(/\s+/g," ")},count:function(t,n){if(null==t||null==n)return 0;t=e(t),n=e(n);for(var r=0,i=0,s=n.length;i=t.indexOf(n,i),-1!==i;)r++,i+=s;return r},chars:function(t){return null==t?[]:e(t).split("")},swapCase:function(t){return null==t?"":e(t).replace(/\S/g,function(t){return t===t.toUpperCase()?t.toLowerCase():t.toUpperCase()})},escapeHTML:function(t){return null==t?"":e(t).replace(/[&<>"']/g,function(t){return"&"+f[t]+";"})},unescapeHTML:function(t){return null==t?"":e(t).replace(/\&([^;]+);/g,function(t,n){var r;return n in l?l[n]:(r=n.match(/^#x([\da-fA-F]+)$/))?e.fromCharCode(parseInt(r[1],16)):(r=n.match(/^#(\d+)$/))?e.fromCharCode(~~r[1]):t})},escapeRegExp:function(t){return null==t?"":e(t).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")},splice:function(t,e,n,r){var i=p.chars(t);return i.splice(~~e,~~n,r),i.join("")},insert:function(t,e,n){return p.splice(t,e,0,n)},include:function(t,n){return""===n?!0:null==t?!1:-1!==e(t).indexOf(n)},join:function(){var t=u.call(arguments),e=t.shift();return null==e&&(e=""),t.join(e)},lines:function(t){return null==t?[]:e(t).split("\n")},reverse:function(t){return p.chars(t).reverse().join("")},startsWith:function(t,n){return""===n?!0:null==t||null==n?!1:(t=e(t),n=e(n),t.length>=n.length&&t.slice(0,n.length)===n)},endsWith:function(t,n){return""===n?!0:null==t||null==n?!1:(t=e(t),n=e(n),t.length>=n.length&&t.slice(t.length-n.length)===n)},succ:function(t){return null==t?"":(t=e(t),t.slice(0,-1)+e.fromCharCode(t.charCodeAt(t.length-1)+1))},titleize:function(t){return null==t?"":(t=e(t).toLowerCase(),t.replace(/(?:^|\s|-)\S/g,function(t){return t.toUpperCase()}))},camelize:function(t){return p.trim(t).replace(/[-_\s]+(.)?/g,function(t,e){return e?e.toUpperCase():""})},underscored:function(t){return p.trim(t).replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/[-\s]+/g,"_").toLowerCase()},dasherize:function(t){return p.trim(t).replace(/([A-Z])/g,"-$1").replace(/[-_\s]+/g,"-").toLowerCase()},classify:function(t){return p.titleize(e(t).replace(/[\W_]/g," ")).replace(/\s/g,"")},humanize:function(t){return p.capitalize(p.underscored(t).replace(/_id$/,"").replace(/_/g," "))},trim:function(t,n){return null==t?"":!n&&r?r.call(t):(n=c(n),e(t).replace(new RegExp("^"+n+"+|"+n+"+$","g"),""))},ltrim:function(t,n){return null==t?"":!n&&s?s.call(t):(n=c(n),e(t).replace(new RegExp("^"+n+"+"),""))},rtrim:function(t,n){return null==t?"":!n&&i?i.call(t):(n=c(n),e(t).replace(new RegExp(n+"+$"),""))},truncate:function(t,n,r){return null==t?"":(t=e(t),r=r||"...",n=~~n,t.length>n?t.slice(0,n)+r:t)},prune:function(t,n,r){if(null==t)return"";if(t=e(t),n=~~n,r=null!=r?e(r):"...",n>=t.length)return t;var i=function(t){return t.toUpperCase()!==t.toLowerCase()?"A":" "},s=t.slice(0,n+1).replace(/.(?=\W*\w*$)/g,i);return s=s.slice(s.length-2).match(/\w\w/)?s.replace(/\s*\S+$/,""):p.rtrim(s.slice(0,s.length-1)),(s+r).length>t.length?t:t.slice(0,s.length)+r},words:function(t,e){return p.isBlank(t)?[]:p.trim(t,e).split(e||/\s+/)},pad:function(t,n,r,i){t=null==t?"":e(t),n=~~n;var s=0;switch(r?r.length>1&&(r=r.charAt(0)):r=" ",i){case"right":return s=n-t.length,t+a(r,s);case"both":return s=n-t.length,a(r,Math.ceil(s/2))+t+a(r,Math.floor(s/2));default:return s=n-t.length,a(r,s)+t}},lpad:function(t,e,n){return p.pad(t,e,n)},rpad:function(t,e,n){return p.pad(t,e,n,"right")},lrpad:function(t,e,n){return p.pad(t,e,n,"both")},sprintf:d,vsprintf:function(t,e){return e.unshift(t),d.apply(null,e)},toNumber:function(t,e){return t?(t=p.trim(t),t.match(/^-?\d+(?:\.\d+)?$/)?o(o(t).toFixed(~~e)):NaN):0},numberFormat:function(t,e,n,r){if(isNaN(t)||null==t)return"";t=t.toFixed(~~e),r="string"==typeof r?r:",";var i=t.split("."),s=i[0],o=i[1]?(n||".")+i[1]:"";return s.replace(/(\d)(?=(?:\d{3})+$)/g,"$1"+r)+o},strRight:function(t,n){if(null==t)return"";t=e(t),n=null!=n?e(n):n;var r=n?t.indexOf(n):-1;return~r?t.slice(r+n.length,t.length):t},strRightBack:function(t,n){if(null==t)return"";t=e(t),n=null!=n?e(n):n;var r=n?t.lastIndexOf(n):-1;return~r?t.slice(r+n.length,t.length):t},strLeft:function(t,n){if(null==t)return"";t=e(t),n=null!=n?e(n):n;var r=n?t.indexOf(n):-1;return~r?t.slice(0,r):t},strLeftBack:function(t,e){if(null==t)return"";t+="",e=null!=e?""+e:e;var n=t.lastIndexOf(e);return~n?t.slice(0,n):t},toSentence:function(t,e,n,r){e=e||", ",n=n||" and ";var i=t.slice(),s=i.pop();return t.length>2&&r&&(n=p.rtrim(e)+n),i.length?i.join(e)+n+s:s},toSentenceSerial:function(){var t=u.call(arguments);return t[3]=!0,p.toSentence.apply(p,t)},slugify:function(t){if(null==t)return"";var n="\u0105\xe0\xe1\xe4\xe2\xe3\xe5\xe6\u0103\u0107\u0119\xe8\xe9\xeb\xea\xec\xed\xef\xee\u0142\u0144\xf2\xf3\xf6\xf4\xf5\xf8\u015b\u0219\u021b\xf9\xfa\xfc\xfb\xf1\xe7\u017c\u017a",r="aaaaaaaaaceeeeeiiiilnoooooosstuuuunczz",i=new RegExp(c(n),"g");return t=e(t).toLowerCase().replace(i,function(t){var e=n.indexOf(t);return r.charAt(e)||"-"}),p.dasherize(t.replace(/[^\w\s-]/g,""))},surround:function(t,e){return[e,t,e].join("")},quote:function(t,e){return p.surround(t,e||'"')},unquote:function(t,e){return e=e||'"',t[0]===e&&t[t.length-1]===e?t.slice(1,t.length-1):t},exports:function(){var t={};for(var e in this)this.hasOwnProperty(e)&&!e.match(/^(?:include|contains|reverse)$/)&&(t[e]=this[e]);return t},repeat:function(t,n,r){if(null==t)return"";if(n=~~n,null==r)return a(e(t),n);for(var i=[];n>0;i[--n]=t);return i.join(r)},naturalCmp:function(t,n){if(t==n)return 0;if(!t)return-1;if(!n)return 1;for(var r=/(\.\d+)|(\d+)|(\D+)/g,i=e(t).toLowerCase().match(r),s=e(n).toLowerCase().match(r),o=Math.min(i.length,s.length),a=0;o>a;a++){var u=i[a],c=s[a];if(u!==c){var l=parseInt(u,10);if(!isNaN(l)){var f=parseInt(c,10);if(!isNaN(f)&&l-f)return l-f}return c>u?-1:1}}return i.length===s.length?i.length-s.length:n>t?-1:1},levenshtein:function(t,n){if(null==t&&null==n)return 0;if(null==t)return e(n).length;if(null==n)return e(t).length;t=e(t),n=e(n);for(var r,i,s=[],o=0;n.length>=o;o++)for(var a=0;t.length>=a;a++)i=o&&a?t.charAt(a-1)===n.charAt(o-1)?r:Math.min(s[a],s[a-1],r)+1:o+a,r=s[a],s[a]=i;return s.pop()},toBoolean:function(t,e,r){return"number"==typeof t&&(t=""+t),"string"!=typeof t?!!t:(t=p.trim(t),n(t,e||["true","1"])?!0:n(t,r||["false","0"])?!1:void 0)}};p.strip=p.trim,p.lstrip=p.ltrim,p.rstrip=p.rtrim,p.center=p.lrpad,p.rjust=p.lpad,p.ljust=p.rpad,p.contains=p.include,p.q=p.quote,p.toBool=p.toBoolean,"undefined"!=typeof exports&&("undefined"!=typeof module&&module.exports&&(module.exports=p),exports._s=p),"function"==typeof define&&define.amd&&define("underscore.string",[],function(){return p}),t._=t._||{},t._.string=t._.str=p}(this,String),_.mixin(_.str.exports()),$(document).ready(function(){var t=$("#csv-file-input")[0],e=function(){$(t).wrap("<form>").closest("form").get(0).reset(),$(t).unwrap();var e=$("#csv-import-progress");e.text(""),$("#csv-import-errors").html("")};$(t).change(function(){var n=$("#csv-import-progress");n.text("Loading...");var r=new recline.Model.Dataset({file:t.files[0],delimiter:import_csv_delimiter,backend:"csv"});r.fetch().done(function(t){if(!t.recordCount)return alert("No records found. Please save as 'Windows Comma Separated' from Excel (2nd CSV option)."),void e();r.query({size:1});var i=import_csv_required_columns,s=import_csv_columns,o=_.pluck(t.records.first().fields.models,"id"),a=_.map(o,function(t){return _.underscored(t)}),u=_.difference(i,a),c=_.map(u,function(t){return _.humanize(t)});if(u.length>0)alert("The following columns are missing: "+_.toSentence(c)+". Please check your column names.");else{var l=t.recordCount,f=0,h=0,d=function(e,r){e.query({size:100,from:100*r});var i=t.records.models,o=[];_.each(i,function(t){var e={};e._row=h,_.each(_.pairs(t.attributes),function(t){var n=_.underscored(t[0]);if(_.contains(s,n)){var r=t[1];null===r&&(r=""),e[n]=r}}),o.push(e),h+=1});var a={};a[import_csv_resource_name]=o,$.post(import_csv_path,a,null,"json").always(function(t){f+=i.length,n.text("Progress: "+f+" of "+l),$("#csv-import-errors").append(t.responseText),200==t.status?f==l?(n.html("Done. Imported "+l+" records."),redirect_path&&n.html(n.text()+" <a href='"+redirect_path+"'>Click to continue.</a>")):d(e,r+1):alert("Import interrupted. The server could not be reached or encountered an error.")})};d(r,0)}e()})})});