#!/bin/bash

curl -I $WEB_CONTAINER_URL

while ! [ "$?" = "0" ]; do
  echo "Could not connect to web container. Sleeping.";
  sleep 15;
  curl -I $WEB_CONTAINER_URL
done

bundle exec rails db:setup
bundle exec rspec -r rspec_junit_formatter --format progress --format RspecJunitFormatter -o $CIRCLE_TEST_REPORTS/rspec/junit.xml spec/
